<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesla Model 3 Controller</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #ffffff;
            overflow: hidden;
        }

        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        #canvas-container {
            width: 100%;
            height: 100%;
        }

        #controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            min-width: 280px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        #controls h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #3b82f6;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group h3 {
            font-size: 14px;
            color: #9ca3af;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        button {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        button.full-width {
            grid-column: 1 / -1;
        }

        #info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 12px;
            color: #9ca3af;
        }

        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 1000;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="canvas-container"></div>
        
        <div id="loading">
            <div class="spinner"></div>
            <p>Tesla Model 3 ë¡œë”©ì¤‘...</p>
        </div>

        <div id="controls" style="display: none;">
            <h2>ğŸš— Tesla Model 3</h2>
            
            <div class="control-group">
                <h3>ğŸ”’ ë„ì–´ ì ê¸ˆ</h3>
                <div class="button-group">
                    <button id="btn-lock" class="full-width/2">ì ê¸ˆ</button>
                    <button id="btn-unlock" class="full-width/2 active">ì—´ê¸°</button>
                </div>
            </div>

            <div class="control-group">
                <h3>ğŸšª ë„ì–´ ê°œí</h3>
                <div class="button-group">
                    <button id="btn-open-all">ëª¨ë‘ ì—´ê¸°</button>
                    <button id="btn-close-all">ëª¨ë‘ ë‹«ê¸°</button>
                    <button id="btn-door-fl">ì¢Œì¸¡ ì•</button>
                    <button id="btn-door-fr">ìš°ì¸¡ ì•</button>
                    <button id="btn-door-rl">ì¢Œì¸¡ ë’¤</button>
                    <button id="btn-door-rr">ìš°ì¸¡ ë’¤</button>
                </div>
            </div>

            <div class="control-group">
                <h3>ğŸ’¡ ë¼ì´íŠ¸</h3>
                <div class="button-group">
                    <button id="btn-headlight">í—¤ë“œë¼ì´íŠ¸</button>
                    <button id="btn-left-signal">ì¢Œì¸¡ ë°©í–¥ë“±</button>
                    <button id="btn-right-signal">ìš°ì¸¡ ë°©í–¥ë“±</button>
                    <button id="btn-hazard">ë¹„ìƒë“±</button>
                </div>
            </div>

            <div class="control-group">
                <h3>ğŸ”§ íŠ¸ë í¬/ë¯¸ëŸ¬</h3>
                <div class="button-group">
                    <button id="btn-frunk">í”„ë¡ íŠ¸ íŠ¸ë í¬</button>
                    <button id="btn-trunk">ë¦¬ì–´ íŠ¸ë í¬</button>
                    <button id="btn-mirror-fold">ë¯¸ëŸ¬ ì ‘ê¸°</button>
                    <button id="btn-mirror-unfold" class="active">ë¯¸ëŸ¬ í´ê¸°</button>
                </div>
            </div>

            <div class="control-group">
                <h3>ğŸ¨ í…Œë§ˆ</h3>
                <div class="button-group">
                    <button id="btn-theme-dark" class="active">ë‹¤í¬ ëª¨ë“œ</button>
                    <button id="btn-theme-bright">ë¸Œë¼ì´íŠ¸ ëª¨ë“œ</button>
                </div>
            </div>

            <div class="control-group">
                <h3>ğŸš— ì°¨ëŸ‰ ìƒ‰ìƒ</h3>
                <div class="button-group">
                    <button id="btn-color-white" class="active" style="background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%); color: #333;">í™”ì´íŠ¸</button>
                    <button id="btn-color-black" style="background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);">ë¸”ë™</button>
                    <button id="btn-color-red" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">ë ˆë“œ</button>
                    <button id="btn-color-blue" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">ë¸”ë£¨</button>
                    <button id="btn-color-gray" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);">ê·¸ë ˆì´</button>
                    <button id="btn-color-silver" style="background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%); color: #333;">ì‹¤ë²„</button>
                </div>
            </div>

            <div class="control-group">
                <h3>ğŸ”§ ê°œë°œì ë„êµ¬</h3>
                <div class="button-group">
                    <button id="btn-analyze" class="full-width">ëª¨ë¸ êµ¬ì¡° ë¶„ì„</button>
                </div>
            </div>

            <div class="control-group">
                <h3>ğŸ® ë·° ì»¨íŠ¸ë¡¤</h3>
                <div class="button-group">
                    <button id="btn-view-front" class="full-width">ì •ë©´</button>
                    <button id="btn-view-back" class="full-width">í›„ë©´</button>
                    <button id="btn-view-left">ì¢Œì¸¡ë©´</button>
                    <button id="btn-view-right">ìš°ì¸¡ë©´</button>
                    <button id="btn-view-top">ìƒë‹¨</button>
                    <button id="btn-view-bottom">í•˜ë‹¨</button>
                    <button id="btn-reset" class="full-width">ë¦¬ì…‹ (ISO)</button>
                </div>
            </div>
        </div>

        <div id="info">
            <span class="status-indicator"></span>
            <strong>ì¡°ì‘:</strong> ë§ˆìš°ìŠ¤ ë“œë˜ê·¸(íšŒì „) | íœ (ì¤Œ) | ìš°í´ë¦­(ì´ë™)
        </div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.159.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // Scene setup
        const scene = new THREE.Scene();
        let isDarkMode = true;
        const darkColor = 0x1a1a1a;
        const brightColor = 0xe8e8e8;
        scene.background = new THREE.Color(darkColor);
        scene.fog = new THREE.Fog(darkColor, 10, 50);

        // Camera
        const camera = new THREE.PerspectiveCamera(
            45,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        camera.position.set(-5, 3, -5); // ISO ë·° (ì¢Œì¸¡ í›„ë©´)

        // Renderer
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // Controls
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 3;
        controls.maxDistance = 15;
        controls.maxPolarAngle = Math.PI / 2;

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight1.position.set(5, 10, 5);
        directionalLight1.castShadow = true;
        directionalLight1.shadow.mapSize.width = 2048;
        directionalLight1.shadow.mapSize.height = 2048;
        scene.add(directionalLight1);

        const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
        directionalLight2.position.set(-5, 5, -5);
        scene.add(directionalLight2);

        // Ground
        const groundGeometry = new THREE.CircleGeometry(20, 64);
        const darkGroundColor = 0x2d2d2d;
        const brightGroundColor = 0xcccccc;
        const groundMaterial = new THREE.MeshStandardMaterial({
            color: darkGroundColor,
            roughness: 0.8,
            metalness: 0.2
        });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // Grid
        const darkGridColor1 = 0x444444;
        const darkGridColor2 = 0x333333;
        const brightGridColor1 = 0x999999;
        const brightGridColor2 = 0xaaaaaa;
        const gridHelper = new THREE.GridHelper(20, 20, darkGridColor1, darkGridColor2);
        gridHelper.position.y = 0.01;
        scene.add(gridHelper);

        // Model loading
        let teslaModel = null;
        let carMeshes = []; // ì°¨ëŸ‰ ë©”ì‹œë“¤ì„ ì €ì¥
        let lightMeshes = []; // ë¼ì´íŠ¸ ë©”ì‹œë“¤ì„ ì €ì¥
        let signalBlinkInterval = null; // ë°©í–¥ë“± ê¹œë¹¡ì„ ì¸í„°ë²Œ
        let modelParts = {
            doors: {
                fl: null,
                fr: null,
                rl: null,
                rr: null
            },
            frunk: null,
            trunk: null,
            mirrors: {
                left: null,
                right: null
            },
            lights: {
                headlight: null,
                taillight: null,
                leftSignal: null,
                rightSignal: null
            }
        };
        let partStates = {
            doors: { fl: false, fr: false, rl: false, rr: false },
            frunk: false,
            trunk: false,
            locked: false,
            mirrors: { folded: false },
            lights: {
                headlight: false,
                leftSignal: false,
                rightSignal: false,
                hazard: false
            }
        };

        const loader = new GLTFLoader();
        loader.load(
            'tesla_2018_model_3.glb',
            (gltf) => {
                teslaModel = gltf.scene;
                
                // Center and scale model
                const box = new THREE.Box3().setFromObject(teslaModel);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());
                
                const maxDim = Math.max(size.x, size.y, size.z);
                const scale = 4 / maxDim;
                teslaModel.scale.setScalar(scale);
                
                teslaModel.position.sub(center.multiplyScalar(scale));
                // íƒ€ì´ì–´ê°€ ë°”ë‹¥ì— ë‹¿ë„ë¡ Yì¶• ì¡°ì •
                const minY = box.min.y * scale;
                teslaModel.position.y = -minY;

                // Enable shadows and find controllable parts
                teslaModel.traverse((child) => {
                    // ë„ì–´ ì°¾ê¸°
                    if (child.name === 'door_lf') modelParts.doors.fl = child;
                    if (child.name === 'door_lr') modelParts.doors.rl = child;
                    if (child.name === 'door_rf') modelParts.doors.fr = child;
                    if (child.name === 'door_rr') modelParts.doors.rr = child;
                    
                    // íŠ¸ë í¬/í›„ë“œ ì°¾ê¸°
                    if (child.name === 'boot_dummy') modelParts.trunk = child;
                    if (child.name === 'bonnet_dummy') modelParts.frunk = child;
                    
                    // ë¼ì´íŠ¸ ë©”ì‹œ ì°¾ê¸°
                    if (child.name === 'chrome_Lights_head_l' || child.name === 'chrome_foglight_l' || child.name === 'chrome_foglight_r') {
                        modelParts.lights.headlight = child;
                    }
                    if (child.name === 'turn_indicat_l') modelParts.lights.leftSignal = child;
                    if (child.name === 'turn_indicat_r') modelParts.lights.rightSignal = child;
                    if (child.name === 'rear_lights') modelParts.lights.taillight = child;
                    
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                        
                        // ì°¨ëŸ‰ ë©”ì‹œ ìˆ˜ì§‘ (ë°”í€´, ìœ ë¦¬ ë“± ì œì™¸í•˜ê³  ì°¨ì²´ë§Œ)
                        if (child.material && child.name.toLowerCase().indexOf('wheel') === -1 
                            && child.name.toLowerCase().indexOf('tire') === -1
                            && child.name.toLowerCase().indexOf('glass') === -1
                            && child.name.toLowerCase().indexOf('window') === -1) {
                            carMeshes.push(child);
                        }
                        
                        // ë¼ì´íŠ¸ ë©”ì‹œ ìˆ˜ì§‘
                        const nameLower = child.name.toLowerCase();
                        if (nameLower.indexOf('light') !== -1 || 
                            nameLower.indexOf('lamp') !== -1 ||
                            nameLower.indexOf('indicator') !== -1 ||
                            nameLower.indexOf('foglight') !== -1) {
                            lightMeshes.push(child);
                        }
                    }
                });

                console.log('=== ì œì–´ ê°€ëŠ¥ íŒŒíŠ¸ í™•ì¸ ===');
                console.log(`ë„ì–´ FL: ${modelParts.doors.fl ? 'âœ“' : 'âœ—'}`);
                console.log(`ë„ì–´ FR: ${modelParts.doors.fr ? 'âœ“' : 'âœ—'}`);
                console.log(`ë„ì–´ RL: ${modelParts.doors.rl ? 'âœ“' : 'âœ—'}`);
                console.log(`ë„ì–´ RR: ${modelParts.doors.rr ? 'âœ“' : 'âœ—'}`);
                console.log(`í”„ë¡ íŠ¸ íŠ¸ë í¬: ${modelParts.frunk ? 'âœ“' : 'âœ—'}`);
                console.log(`ë¦¬ì–´ íŠ¸ë í¬: ${modelParts.trunk ? 'âœ“' : 'âœ—'}`);
                console.log(`ë¼ì´íŠ¸ ë©”ì‹œ: ${lightMeshes.length}ê°œ`);

                console.log('=== Tesla Model 3 Structure ===');
                let meshCount = 0;
                let result = '\n=== Tesla Model 3 GLB êµ¬ì¡° ë¶„ì„ ===\n\n';
                
                teslaModel.traverse((child) => {
                    if (child.name) {
                        const indent = '  '.repeat(getDepth(child));
                        result += `${indent}[${child.type}] ${child.name}\n`;
                        console.log(`${indent}Name: ${child.name}, Type: ${child.type}`);
                        
                        if (child.isMesh) {
                            meshCount++;
                            const vertexCount = child.geometry.attributes.position.count;
                            result += `${indent}  â”” Vertices: ${vertexCount}\n`;
                            console.log(`${indent}  â”” Vertices: ${vertexCount}`);
                            
                            if (child.material) {
                                if (Array.isArray(child.material)) {
                                    result += `${indent}  â”” Materials: ${child.material.length}\n`;
                                    console.log(`${indent}  â”” Materials: ${child.material.length}`);
                                } else {
                                    result += `${indent}  â”” Material: ${child.material.name || child.material.type}\n`;
                                    console.log(`${indent}  â”” Material: ${child.material.name || child.material.type}`);
                                }
                            }
                        }
                    }
                });
                
                result += `\nì´ ë©”ì‹œ ìˆ˜: ${meshCount}\n`;
                result += `ì´ ì˜¤ë¸Œì íŠ¸: ${carMeshes.length}ê°œ ì°¨ì²´ ë©”ì‹œ\n`;
                result += `\në¶„ì„ ì™„ë£Œ! ê°œë°œì ë„êµ¬(F12) Console íƒ­ì—ì„œ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.\n`;
                
                console.log('\n' + '='.repeat(60));
                console.log(`ì´ ë©”ì‹œ ìˆ˜: ${meshCount}`);
                console.log(`ì´ ì°¨ì²´ ë©”ì‹œ: ${carMeshes.length}`);
                console.log('='.repeat(60));
                
                // Alertë¡œë„ ìš”ì•½ í‘œì‹œ
                alert(result);
                
                function getDepth(obj) {
                    let depth = 0;
                    let current = obj;
                    while (current.parent) {
                        depth++;
                        current = current.parent;
                    }
                    return depth;
                }

                scene.add(teslaModel);
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('controls').style.display = 'block';
            },
            (progress) => {
                const percent = (progress.loaded / progress.total * 100).toFixed(0);
                console.log(`Loading: ${percent}%`);
            },
            (error) => {
                console.error('Error loading model:', error);
                document.getElementById('loading').innerHTML = '<p>ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨</p>';
            }
        );

        // Animation helpers
        function animateRotation(object, targetRotation, duration = 500) {
            if (!object) return;
            
            const startRotation = { ...object.rotation };
            const startTime = Date.now();
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic
                
                object.rotation.y = startRotation.y + (targetRotation - startRotation.y) * eased;
                object.rotation.z = startRotation.z + (targetRotation - startRotation.z) * eased * 0.3;
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }
            
            animate();
        }

        // Button handlers
        function toggleButton(buttonId, state) {
            const button = document.getElementById(buttonId);
            if (state) {
                button.classList.add('active');
            } else {
                button.classList.remove('active');
            }
        }

        // Animation helper function
        function animatePart(part, targetRotation, axis = 'y', duration = 800) {
            if (!part) return;
            
            const startRotation = part.rotation[axis];
            const startTime = Date.now();
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                // Ease-out cubic
                const eased = 1 - Math.pow(1 - progress, 3);
                
                part.rotation[axis] = startRotation + (targetRotation - startRotation) * eased;
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }
            
            animate();
        }

        // Door lock/unlock controls
        document.getElementById('btn-lock').addEventListener('click', () => {
            partStates.locked = true;
            toggleButton('btn-lock', true);
            toggleButton('btn-unlock', false);
            //console.log('ì°¨ëŸ‰ ì ê¸ˆ');
			// ë¹„ìƒë“± 2íšŒ ê¹œë¹¡ì„
            flashHazardLights(2);
            
            // ì ê¸ˆ ì†Œë¦¬ (ë¹„í”„ìŒ 2íšŒ)
            //playBeep(2, 200);
			playSound('lock-unlock.mp3');
            
            console.log('ğŸ”’ ì°¨ëŸ‰ ì ê¸ˆ (ë¹„ìƒë“± 2íšŒ ê¹œë¹¡ì„)');
        });

        document.getElementById('btn-unlock').addEventListener('click', () => {
            partStates.locked = false;
            toggleButton('btn-lock', false);
            toggleButton('btn-unlock', true);
            //console.log('ì°¨ëŸ‰ ì ê¸ˆ í•´ì œ');
            // ë¹„ìƒë“± 1íšŒ ê¹œë¹¡ì„
            flashHazardLights(1);
            
            // í•´ì œ ì†Œë¦¬ (ë¹„í”„ìŒ 1íšŒ)
            //playBeep(1, 150);
			playSound('lock-unlock.mp3');
            
            console.log('ğŸ”“ ì°¨ëŸ‰ ì ê¸ˆ í•´ì œ (ë¹„ìƒë“± 1íšŒ ê¹œë¹¡ì„)');			
        });

        // ë¹„ìƒë“± ê¹œë¹¡ì„ íš¨ê³¼
        function flashHazardLights(count) {
            let flashCount = 0;
            const flashInterval = setInterval(() => {
                const isOn = flashCount % 2 === 0;
                
                // ë¼ì´íŠ¸ ë©”ì‹œ ê¹œë¹¡ì„
                lightMeshes.forEach(mesh => {
                    const nameLower = mesh.name.toLowerCase();
                    if (nameLower.indexOf('indicator') !== -1 || 
                        nameLower.indexOf('turn_indicat') !== -1) {
                        if (mesh.material) {
                            if (isOn) {
                                mesh.material.emissive = new THREE.Color(0xffaa00);
                                mesh.material.emissiveIntensity = 1.0;
                            } else {
                                mesh.material.emissive = new THREE.Color(0x000000);
                                mesh.material.emissiveIntensity = 0;
                            }
                        }
                    }
                });
                
                console.log(isOn ? 'ğŸ’¡ ë¹„ìƒë“± ON' : 'âš« ë¹„ìƒë“± OFF');
                
                flashCount++;
                if (flashCount >= count * 2) {
                    clearInterval(flashInterval);
                    // ê¹œë¹¡ì„ ì¢…ë£Œ í›„ ë„ê¸°
                    lightMeshes.forEach(mesh => {
                        if (mesh.material) {
                            mesh.material.emissive = new THREE.Color(0x000000);
                            mesh.material.emissiveIntensity = 0;
                        }
                    });
                }
            }, 200); // 200ms ê°„ê²©
        }

        // ì‚¬ìš´ë“œ ì¬ìƒ
        function playSound(filename) {
            const audio = new Audio(filename);
            audio.volume = 0.5; // ë³¼ë¥¨ 50%
            audio.play().catch(err => {
                console.log('ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨:', err);
            });
        }

        // ë¹„í”„ìŒ ì¬ìƒ
        function playBeep(count, duration) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            let beepCount = 0;
            
            function beep() {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800; // 800Hz
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration / 1000);
                
                beepCount++;
                if (beepCount < count) {
                    setTimeout(beep, duration + 100);
                }
            }
            
            beep();
        }
		
        // Open/Close All controls
        document.getElementById('btn-open-all').addEventListener('click', () => {
            if (partStates.locked) {
                alert('ì°¨ëŸ‰ì´ ì ê²¨ìˆìŠµë‹ˆë‹¤. ë¨¼ì € ì ê¸ˆì„ í•´ì œí•˜ì„¸ìš”.');
                return;
            }
            
            // ëª¨ë“  ë„ì–´ ì—´ê¸°
            if (modelParts.doors.fl && !partStates.doors.fl) {
                partStates.doors.fl = true;
                toggleButton('btn-door-fl', true);
                animatePart(modelParts.doors.fl, -Math.PI / 3, 'z');
            }
            if (modelParts.doors.fr && !partStates.doors.fr) {
                partStates.doors.fr = true;
                toggleButton('btn-door-fr', true);
                animatePart(modelParts.doors.fr, Math.PI / 3, 'z');
            }
            if (modelParts.doors.rl && !partStates.doors.rl) {
                partStates.doors.rl = true;
                toggleButton('btn-door-rl', true);
                animatePart(modelParts.doors.rl, -Math.PI / 3, 'z');
            }
            if (modelParts.doors.rr && !partStates.doors.rr) {
                partStates.doors.rr = true;
                toggleButton('btn-door-rr', true);
                animatePart(modelParts.doors.rr, Math.PI / 3, 'z');
            }
            
            // í”„ë¡ íŠ¸ íŠ¸ë í¬ ì—´ê¸°
            if (modelParts.frunk && !partStates.frunk) {
                partStates.frunk = true;
                toggleButton('btn-frunk', true);
                animatePart(modelParts.frunk, Math.PI / 4, 'x');
            }
            
            // ë¦¬ì–´ íŠ¸ë í¬ ì—´ê¸°
            if (modelParts.trunk && !partStates.trunk) {
                partStates.trunk = true;
                toggleButton('btn-trunk', true);
                animatePart(modelParts.trunk, -Math.PI / 4, 'x');
            }
            
			playSound('door_open.mp3');
			
            console.log('ëª¨ë“  ë„ì–´ ë° íŠ¸ë í¬ ì—´ë¦¼');
        });

        document.getElementById('btn-close-all').addEventListener('click', () => {
            // ëª¨ë“  ë„ì–´ ë‹«ê¸°
            if (modelParts.doors.fl && partStates.doors.fl) {
                partStates.doors.fl = false;
                toggleButton('btn-door-fl', false);
                animatePart(modelParts.doors.fl, 0, 'z');
            }
            if (modelParts.doors.fr && partStates.doors.fr) {
                partStates.doors.fr = false;
                toggleButton('btn-door-fr', false);
                animatePart(modelParts.doors.fr, 0, 'z');
            }
            if (modelParts.doors.rl && partStates.doors.rl) {
                partStates.doors.rl = false;
                toggleButton('btn-door-rl', false);
                animatePart(modelParts.doors.rl, 0, 'z');
            }
            if (modelParts.doors.rr && partStates.doors.rr) {
                partStates.doors.rr = false;
                toggleButton('btn-door-rr', false);
                animatePart(modelParts.doors.rr, 0, 'z');
            }
            
            // í”„ë¡ íŠ¸ íŠ¸ë í¬ ë‹«ê¸°
            if (modelParts.frunk && partStates.frunk) {
                partStates.frunk = false;
                toggleButton('btn-frunk', false);
                animatePart(modelParts.frunk, 0, 'x');
            }
            
            // ë¦¬ì–´ íŠ¸ë í¬ ë‹«ê¸°
            if (modelParts.trunk && partStates.trunk) {
                partStates.trunk = false;
                toggleButton('btn-trunk', false);
                animatePart(modelParts.trunk, 0, 'x');
            }
            
			playSound('door_close.mp3');
			
            console.log('ëª¨ë“  ë„ì–´ ë° íŠ¸ë í¬ ë‹«í˜');
        });

        // Door controls with real 3D animation
        document.getElementById('btn-door-fl').addEventListener('click', () => {
            if (partStates.locked) {
                alert('ì°¨ëŸ‰ì´ ì ê²¨ìˆìŠµë‹ˆë‹¤. ë¨¼ì € ì ê¸ˆì„ í•´ì œí•˜ì„¸ìš”.');
                return;
            }
            if (!modelParts.doors.fl) {
                console.log('ë„ì–´ íŒŒíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            partStates.doors.fl = !partStates.doors.fl;
            toggleButton('btn-door-fl', partStates.doors.fl);
            // ì¢Œì¸¡ ë„ì–´ëŠ” Zì¶• ê¸°ì¤€ ì–‘ì˜ ë°©í–¥ìœ¼ë¡œ íšŒì „
            animatePart(modelParts.doors.fl, partStates.doors.fl ? -Math.PI / 3 : 0, 'z');
            console.log('ì¢Œì¸¡ ì• ë„ì–´:', partStates.doors.fl ? 'ì—´ë¦¼' : 'ë‹«í˜');
        });

        document.getElementById('btn-door-fr').addEventListener('click', () => {
            if (partStates.locked) {
                alert('ì°¨ëŸ‰ì´ ì ê²¨ìˆìŠµë‹ˆë‹¤. ë¨¼ì € ì ê¸ˆì„ í•´ì œí•˜ì„¸ìš”.');
                return;
            }
            if (!modelParts.doors.fr) {
                console.log('ë„ì–´ íŒŒíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            partStates.doors.fr = !partStates.doors.fr;
            toggleButton('btn-door-fr', partStates.doors.fr);
            // ìš°ì¸¡ ë„ì–´ëŠ” Zì¶• ê¸°ì¤€ ìŒì˜ ë°©í–¥ìœ¼ë¡œ íšŒì „
            animatePart(modelParts.doors.fr, partStates.doors.fr ? Math.PI / 3 : 0, 'z');
            console.log('ìš°ì¸¡ ì• ë„ì–´:', partStates.doors.fr ? 'ì—´ë¦¼' : 'ë‹«í˜');
        });

        document.getElementById('btn-door-rl').addEventListener('click', () => {
            if (partStates.locked) {
                alert('ì°¨ëŸ‰ì´ ì ê²¨ìˆìŠµë‹ˆë‹¤. ë¨¼ì € ì ê¸ˆì„ í•´ì œí•˜ì„¸ìš”.');
                return;
            }
            if (!modelParts.doors.rl) {
                console.log('ë„ì–´ íŒŒíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            partStates.doors.rl = !partStates.doors.rl;
            toggleButton('btn-door-rl', partStates.doors.rl);
            animatePart(modelParts.doors.rl, partStates.doors.rl ? -Math.PI / 3 : 0, 'z');
            console.log('ì¢Œì¸¡ ë’¤ ë„ì–´:', partStates.doors.rl ? 'ì—´ë¦¼' : 'ë‹«í˜');
        });

        document.getElementById('btn-door-rr').addEventListener('click', () => {
            if (partStates.locked) {
                alert('ì°¨ëŸ‰ì´ ì ê²¨ìˆìŠµë‹ˆë‹¤. ë¨¼ì € ì ê¸ˆì„ í•´ì œí•˜ì„¸ìš”.');
                return;
            }
            if (!modelParts.doors.rr) {
                console.log('ë„ì–´ íŒŒíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            partStates.doors.rr = !partStates.doors.rr;
            toggleButton('btn-door-rr', partStates.doors.rr);
            animatePart(modelParts.doors.rr, partStates.doors.rr ? Math.PI / 3 : 0, 'z');
            console.log('ìš°ì¸¡ ë’¤ ë„ì–´:', partStates.doors.rr ? 'ì—´ë¦¼' : 'ë‹«í˜');
        });

        // Frunk and Trunk controls with real animation
        document.getElementById('btn-frunk').addEventListener('click', () => {
            if (!modelParts.frunk) {
                console.log('í”„ë¡ íŠ¸ íŠ¸ë í¬ íŒŒíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            partStates.frunk = !partStates.frunk;
            toggleButton('btn-frunk', partStates.frunk);
            // í›„ë“œëŠ” Xì¶• ê¸°ì¤€ìœ¼ë¡œ ìœ„ë¡œ ì—´ë¦¼ (ë°©í–¥ ë°˜ì „)
            animatePart(modelParts.frunk, partStates.frunk ? Math.PI / 4 : 0, 'x');
            console.log('í”„ë¡ íŠ¸ íŠ¸ë í¬:', partStates.frunk ? 'ì—´ë¦¼' : 'ë‹«í˜');
        });

        document.getElementById('btn-trunk').addEventListener('click', () => {
            if (!modelParts.trunk) {
                console.log('ë¦¬ì–´ íŠ¸ë í¬ íŒŒíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            partStates.trunk = !partStates.trunk;
            toggleButton('btn-trunk', partStates.trunk);
            // íŠ¸ë í¬ëŠ” Xì¶• ê¸°ì¤€ìœ¼ë¡œ ìœ„ë¡œ ì—´ë¦¼
            animatePart(modelParts.trunk, partStates.trunk ? -Math.PI / 4 : 0, 'x');
            console.log('ë¦¬ì–´ íŠ¸ë í¬:', partStates.trunk ? 'ì—´ë¦¼' : 'ë‹«í˜');
        });

        // Mirror controls
        document.getElementById('btn-mirror-fold').addEventListener('click', () => {
            partStates.mirrors.folded = true;
            toggleButton('btn-mirror-fold', true);
            toggleButton('btn-mirror-unfold', false);
            console.log('ì‚¬ì´ë“œë¯¸ëŸ¬ ì ‘í˜');
        });

        document.getElementById('btn-mirror-unfold').addEventListener('click', () => {
            partStates.mirrors.folded = false;
            toggleButton('btn-mirror-fold', false);
            toggleButton('btn-mirror-unfold', true);
            console.log('ì‚¬ì´ë“œë¯¸ëŸ¬ í¼ì¹¨');
        });

        // Light controls
        function stopSignalBlink() {
            if (signalBlinkInterval) {
                clearInterval(signalBlinkInterval);
                signalBlinkInterval = null;
            }
        }

        document.getElementById('btn-headlight').addEventListener('click', () => {
            partStates.lights.headlight = !partStates.lights.headlight;
            toggleButton('btn-headlight', partStates.lights.headlight);
            
            // ë¼ì´íŠ¸ ë°ê¸° ì¡°ì ˆ (ì‹œë®¬ë ˆì´ì…˜)
            lightMeshes.forEach(mesh => {
                if (mesh.material) {
                    if (partStates.lights.headlight) {
                        mesh.material.emissive = new THREE.Color(0xffffaa);
                        mesh.material.emissiveIntensity = 0.8;
                    } else {
                        mesh.material.emissive = new THREE.Color(0x000000);
                        mesh.material.emissiveIntensity = 0;
                    }
                }
            });
            
            console.log('í—¤ë“œë¼ì´íŠ¸:', partStates.lights.headlight ? 'ON' : 'OFF');
        });

        document.getElementById('btn-left-signal').addEventListener('click', () => {
            stopSignalBlink();
            partStates.lights.leftSignal = !partStates.lights.leftSignal;
            partStates.lights.rightSignal = false;
            partStates.lights.hazard = false;
            
            toggleButton('btn-left-signal', partStates.lights.leftSignal);
            toggleButton('btn-right-signal', false);
            toggleButton('btn-hazard', false);
            
            if (partStates.lights.leftSignal) {
                // ê¹œë¹¡ì„ íš¨ê³¼ (ì‹œë®¬ë ˆì´ì…˜)
                let blinkState = false;
                signalBlinkInterval = setInterval(() => {
                    blinkState = !blinkState;
                    console.log('ì¢Œì¸¡ ë°©í–¥ë“±:', blinkState ? 'â—' : 'â—‹');
                }, 500);
            }
            
            console.log('ì¢Œì¸¡ ë°©í–¥ë“±:', partStates.lights.leftSignal ? 'ON' : 'OFF');
        });

        document.getElementById('btn-right-signal').addEventListener('click', () => {
            stopSignalBlink();
            partStates.lights.rightSignal = !partStates.lights.rightSignal;
            partStates.lights.leftSignal = false;
            partStates.lights.hazard = false;
            
            toggleButton('btn-right-signal', partStates.lights.rightSignal);
            toggleButton('btn-left-signal', false);
            toggleButton('btn-hazard', false);
            
            if (partStates.lights.rightSignal) {
                // ê¹œë¹¡ì„ íš¨ê³¼ (ì‹œë®¬ë ˆì´ì…˜)
                let blinkState = false;
                signalBlinkInterval = setInterval(() => {
                    blinkState = !blinkState;
                    console.log('ìš°ì¸¡ ë°©í–¥ë“±:', blinkState ? 'â—' : 'â—‹');
                }, 500);
            }
            
            console.log('ìš°ì¸¡ ë°©í–¥ë“±:', partStates.lights.rightSignal ? 'ON' : 'OFF');
        });

        document.getElementById('btn-hazard').addEventListener('click', () => {
            stopSignalBlink();
            partStates.lights.hazard = !partStates.lights.hazard;
            partStates.lights.leftSignal = false;
            partStates.lights.rightSignal = false;
            
            toggleButton('btn-hazard', partStates.lights.hazard);
            toggleButton('btn-left-signal', false);
            toggleButton('btn-right-signal', false);
            
            if (partStates.lights.hazard) {
                // ë¹„ìƒë“± ê¹œë¹¡ì„ íš¨ê³¼ (ì‹œë®¬ë ˆì´ì…˜)
                let blinkState = false;
                signalBlinkInterval = setInterval(() => {
                    blinkState = !blinkState;
                    console.log('ë¹„ìƒë“±:', blinkState ? 'â—â—' : 'â—‹â—‹');
                }, 500);
            }
            
            console.log('ë¹„ìƒë“±:', partStates.lights.hazard ? 'ON' : 'OFF');
        });

        // Developer tools
        document.getElementById('btn-analyze').addEventListener('click', () => {
            if (!teslaModel) {
                alert('ëª¨ë¸ì´ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.clear();
            console.log('\n' + '='.repeat(70));
            console.log('ğŸ” Tesla Model 3 GLB êµ¬ì¡° ë¶„ì„');
            console.log('='.repeat(70) + '\n');
            
            let meshCount = 0;
            let objectList = [];
            
            teslaModel.traverse((child) => {
                const depth = getDepthLevel(child);
                const indent = '  '.repeat(depth);
                
                let info = `${indent}[${child.type}] ${child.name || '(unnamed)'}`;
                
                if (child.isMesh) {
                    meshCount++;
                    const vertexCount = child.geometry.attributes.position.count;
                    info += ` - ${vertexCount} vertices`;
                    
                    if (child.material) {
                        if (Array.isArray(child.material)) {
                            info += ` - ${child.material.length} materials`;
                        } else {
                            info += ` - ${child.material.type}`;
                        }
                    }
                }
                
                objectList.push(info);
                console.log(info);
            });
            
            console.log('\n' + '-'.repeat(70));
            console.log(`ğŸ“Š ì´ ë©”ì‹œ ìˆ˜: ${meshCount}`);
            console.log(`ğŸ“¦ ì´ ì°¨ì²´ ë©”ì‹œ: ${carMeshes.length}ê°œ`);
            console.log(`ğŸ’¡ ì´ ë¼ì´íŠ¸ ë©”ì‹œ: ${lightMeshes.length}ê°œ`);
            console.log('-'.repeat(70));
            
            if (meshCount <= 10) {
                console.log('\nâš ï¸ ê²½ê³ : ì´ ëª¨ë¸ì€ ì†Œìˆ˜ì˜ ë©”ì‹œë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                console.log('âš ï¸ ë„ì–´, íŠ¸ë í¬ ë“±ì´ ê°œë³„ ì˜¤ë¸Œì íŠ¸ë¡œ ë¶„ë¦¬ë˜ì§€ ì•Šì•˜ì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.');
                console.log('\ní•´ê²° ë°©ë²•:');
                console.log('1. Blenderì—ì„œ ëª¨ë¸ì„ ì—´ì–´ íŒŒíŠ¸ë³„ë¡œ ë¶„ë¦¬');
                console.log('2. ê° íŒŒíŠ¸ì— ì˜ë¯¸ìˆëŠ” ì´ë¦„ ë¶€ì—¬ (door_fl, trunk ë“±)');
                console.log('3. í”¼ë²— í¬ì¸íŠ¸ ì„¤ì • (íšŒì „ ì¤‘ì‹¬ì )');
                console.log('4. ìˆ˜ì •ëœ GLBë¡œ ë‹¤ì‹œ ìµìŠ¤í¬íŠ¸');
            } else {
                console.log('\nâœ… ì´ ëª¨ë¸ì€ ì—¬ëŸ¬ ë©”ì‹œë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                console.log('âœ… ìœ„ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì œì–´ ê°€ëŠ¥í•œ íŒŒíŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
            }
            
            console.log('='.repeat(70) + '\n');
            
            alert(`ëª¨ë¸ êµ¬ì¡° ë¶„ì„ ì™„ë£Œ!\n\nì´ ë©”ì‹œ: ${meshCount}ê°œ\nì°¨ì²´ ë©”ì‹œ: ${carMeshes.length}ê°œ\në¼ì´íŠ¸ ë©”ì‹œ: ${lightMeshes.length}ê°œ\n\nìƒì„¸ ì •ë³´ëŠ” ê°œë°œì ë„êµ¬(F12) Console íƒ­ì„ í™•ì¸í•˜ì„¸ìš”.`);
        });
        
        function getDepthLevel(obj) {
            let depth = 0;
            let current = obj;
            while (current.parent) {
                depth++;
                current = current.parent;
            }
            return depth;
        }

        // View controls
        document.getElementById('btn-view-front').addEventListener('click', () => {
            camera.position.set(0, 1.5, -6); // ì •ë©´ (Zì¶• ìŒìˆ˜ë¡œ ìˆ˜ì •)
            controls.target.set(0, 1, 0);
            controls.update();
        });

        document.getElementById('btn-view-back').addEventListener('click', () => {
            camera.position.set(0, 1.5, 6); // í›„ë©´ (Zì¶• ì–‘ìˆ˜ë¡œ ìˆ˜ì •)
            controls.target.set(0, 1, 0);
            controls.update();
        });

        document.getElementById('btn-view-left').addEventListener('click', () => {
            camera.position.set(6, 1.5, 0); // ì¢Œì¸¡ë©´ (Xì¶• ì–‘ìˆ˜ë¡œ ìˆ˜ì •)
            controls.target.set(0, 1, 0);
            controls.update();
        });

        document.getElementById('btn-view-right').addEventListener('click', () => {
            camera.position.set(-6, 1.5, 0); // ìš°ì¸¡ë©´ (Xì¶• ìŒìˆ˜ë¡œ ìˆ˜ì •)
            controls.target.set(0, 1, 0);
            controls.update();
        });

        document.getElementById('btn-view-top').addEventListener('click', () => {
            camera.position.set(0, 8, 0.1); // ìƒë‹¨
            controls.target.set(0, 0, 0);
            controls.update();
        });

        document.getElementById('btn-view-bottom').addEventListener('click', () => {
            camera.position.set(0, -8, 0); // í•˜ë‹¨ (ìƒë‹¨ì˜ ë°˜ëŒ€í¸, Zì¶• ìŒìˆ˜)
            controls.target.set(0, 0, 0);
            controls.update();
        });

        // Theme controls
        function setTheme(dark) {
            isDarkMode = dark;
            const bgColor = dark ? darkColor : brightColor;
            const gColor = dark ? darkGroundColor : brightGroundColor;
            const grid1 = dark ? darkGridColor1 : brightGridColor1;
            const grid2 = dark ? darkGridColor2 : brightGridColor2;
            
            scene.background = new THREE.Color(bgColor);
            scene.fog = new THREE.Fog(bgColor, 10, 50);
            groundMaterial.color.setHex(gColor);
            gridHelper.material.color.setHex(grid1);
            gridHelper.material.vertexColors = false;
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            if (dark) {
                document.getElementById('btn-theme-dark').classList.add('active');
                document.getElementById('btn-theme-bright').classList.remove('active');
                document.body.style.background = 'linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)';
            } else {
                document.getElementById('btn-theme-dark').classList.remove('active');
                document.getElementById('btn-theme-bright').classList.add('active');
                document.body.style.background = 'linear-gradient(135deg, #e0e0e0 0%, #f5f5f5 100%)';
            }
        }

        document.getElementById('btn-theme-dark').addEventListener('click', () => {
            setTheme(true);
        });

        document.getElementById('btn-theme-bright').addEventListener('click', () => {
            setTheme(false);
        });

        // Car color controls
        const carColors = {
            white: 0xf5f5f5,
            black: 0x1a1a1a,
            red: 0xcc0000,
            blue: 0x1e40af,
            gray: 0x4b5563,
            silver: 0xc0c0c0
        };

        function setCarColor(colorName) {
            const color = carColors[colorName];
            if (!color) return;

            carMeshes.forEach(mesh => {
                if (mesh.material) {
                    // ê¸°ì¡´ materialì˜ ì†ì„±ì„ ìœ ì§€í•˜ë©´ì„œ ìƒ‰ìƒë§Œ ë³€ê²½
                    if (Array.isArray(mesh.material)) {
                        mesh.material.forEach(mat => {
                            mat.color.setHex(color);
                        });
                    } else {
                        mesh.material.color.setHex(color);
                    }
                }
            });

            // ëª¨ë“  ìƒ‰ìƒ ë²„íŠ¼ì˜ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('[id^="btn-color-"]').forEach(btn => {
                btn.classList.remove('active');
            });
            // ì„ íƒëœ ìƒ‰ìƒ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
            document.getElementById(`btn-color-${colorName}`).classList.add('active');
        }

        document.getElementById('btn-color-white').addEventListener('click', () => {
            setCarColor('white');
        });

        document.getElementById('btn-color-black').addEventListener('click', () => {
            setCarColor('black');
        });

        document.getElementById('btn-color-red').addEventListener('click', () => {
            setCarColor('red');
        });

        document.getElementById('btn-color-blue').addEventListener('click', () => {
            setCarColor('blue');
        });

        document.getElementById('btn-color-gray').addEventListener('click', () => {
            setCarColor('gray');
        });

        document.getElementById('btn-color-silver').addEventListener('click', () => {
            setCarColor('silver');
        });

        document.getElementById('btn-reset').addEventListener('click', () => {
            camera.position.set(-5, 3, -5); // ISO ë·° (ì¢Œì¸¡ í›„ë©´)
            controls.target.set(0, 1, 0);
            controls.update();
            
            // Reset all door rotations
            if (modelParts.doors.fl) modelParts.doors.fl.rotation.z = 0;
            if (modelParts.doors.fr) modelParts.doors.fr.rotation.z = 0;
            if (modelParts.doors.rl) modelParts.doors.rl.rotation.z = 0;
            if (modelParts.doors.rr) modelParts.doors.rr.rotation.z = 0;
            if (modelParts.frunk) modelParts.frunk.rotation.x = 0;
            if (modelParts.trunk) modelParts.trunk.rotation.x = 0;
            
            // Reset all parts
            Object.keys(partStates.doors).forEach(key => {
                partStates.doors[key] = false;
                toggleButton(`btn-door-${key}`, false);
            });
            partStates.frunk = false;
            partStates.trunk = false;
            partStates.locked = false;
            partStates.mirrors.folded = false;
            
            toggleButton('btn-frunk', false);
            toggleButton('btn-trunk', false);
            toggleButton('btn-lock', false);
            toggleButton('btn-unlock', true);
            toggleButton('btn-mirror-fold', false);
            toggleButton('btn-mirror-unfold', true);
            
            // Reset lights
            stopSignalBlink();
            partStates.lights.headlight = false;
            partStates.lights.leftSignal = false;
            partStates.lights.rightSignal = false;
            partStates.lights.hazard = false;
            
            toggleButton('btn-headlight', false);
            toggleButton('btn-left-signal', false);
            toggleButton('btn-right-signal', false);
            toggleButton('btn-hazard', false);
            
            // Reset light emissive
            lightMeshes.forEach(mesh => {
                if (mesh.material) {
                    mesh.material.emissive = new THREE.Color(0x000000);
                    mesh.material.emissiveIntensity = 0;
                }
            });
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // Window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
